<div class="login">
  <mat-card class="login__card">
    <div class="login__logo">
      <img src="assets/img/logo.svg" alt="Logo" class="login__logo-image" />
    </div>

    <div class="login__divider"></div>

    <div class="login__content">
      <h1 class="login__heading">Welcome</h1>
      <h3 class="login__subheading">Sign in to continue</h3>
    </div>

    <div class="login__form-container" *ngIf="!requireNewPassword">
      <form class="login__form" [formGroup]="loginForm">
        <div
          class="login__error"
          *ngIf="loginForm.errors?.['invalidEntry']"
        >
          Invalid username or password
        </div>

        <div
          class="login__error"
          *ngIf="loginForm.errors?.['accountLocked']"
        >
          Account has been locked due to too many failed attempts
        </div>

        <mat-form-field
          class="login__field"
          appearance="outline"
          [class.login__field--invalid]="loginForm.errors?.['invalidEntry']"
        >
          <mat-label>Email Address</mat-label>
          <input
            matInput
            type="email"
            placeholder="Email Address"
            formControlName="username"
            class="login__input"
          />
          <mat-error>Valid email is required</mat-error>
        </mat-form-field>

        <mat-form-field
          class="login__field"
          appearance="outline"
          [class.login__field--invalid]="loginForm.errors?.['invalidEntry']"
        >
          <mat-label>Password</mat-label>
          <input
            matInput
            type="password"
            placeholder="Password"
            formControlName="password"
            class="login__input"
          />
          <mat-error>Valid password is required</mat-error>
        </mat-form-field>

        <div class="login__actions">
          <button
            *ngIf="!isProcessingToLogin"
            mat-raised-button
            color="primary"
            type="submit"
            class="login__button"
            [disabled]="enableLogin()"
            (click)="loginClick()"
          >
            Login
          </button>

          <button
            *ngIf="isProcessingToLogin"
            mat-raised-button
            color="primary"
            type="button"
            class="login__button q-login__button--processing"
            disabled
          >
            <mat-icon class="login__spinner">refresh</mat-icon>
            Processing
          </button>
        </div>

        <span
          class="login__forgot-link"
          (click)="invokeShowForgotPassword()"
        >
          Forgot Password?
        </span>
      </form>
    </div>

    <div class="login__form-container" *ngIf="requireNewPassword">
      <form class="login__form" [formGroup]="passwordForm">
        <h2 class="login__password-heading">Setup New Password</h2>

        <mat-form-field class="login__field" appearance="outline">
          <mat-label>New Password</mat-label>
          <input
            matInput
            type="password"
            placeholder="New Password"
            formControlName="newPassword"
            class="login__input"
          />
          <mat-icon
            matTooltip="Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, and one number"
            class="login__help-icon"
          >
            help
          </mat-icon>
          <mat-error>
            Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, and one number
          </mat-error>
        </mat-form-field>

        <mat-form-field class="login__field" appearance="outline">
          <mat-label>Confirm New Password</mat-label>
          <input
            matInput
            type="password"
            placeholder="Confirm New Password"
            formControlName="confirmNewPassword"
            class="login__input"
          />
          <mat-error
            *ngIf="passwordForm.get('confirmNewPassword')?.hasError('required')"
          >
            Please confirm your password
          </mat-error>
          <mat-error
            *ngIf="passwordForm.get('confirmNewPassword')?.hasError('matches')"
          >
            Passwords do not match
          </mat-error>
        </mat-form-field>

        <div class="login__actions">
          <button
            *ngIf="!isProcessingToSetNewPassword"
            mat-raised-button
            color="primary"
            type="submit"
            class="login__button"
            [disabled]="allowPassword"
            (click)="setNewPasswordClick()"
          >
            Set Password
          </button>

          <button
            *ngIf="isProcessingToSetNewPassword"
            mat-raised-button
            color="primary"
            type="button"
            class="login__button q-login__button--processing"
            disabled
          >
            <mat-icon class="login__spinner">refresh</mat-icon>
            Processing
          </button>
        </div>
      </form>
    </div>
  </mat-card>
</div>


